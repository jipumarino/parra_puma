<style>
  .regalo {
    background-color: #3B5998;
    border: 1px solid #1D4088;
    color: white;
    font-family: 'lucida grande', tahoma, verdana, arial, sans-serif;
    width:670px;
    font-size: 14px;
    margin:20px auto;
    padding:15px;
  }
  .reserva {
    display:none;
    padding:10px;
    margin:20px 10px 5px;
    background-color: #627AAD;
    border: 1px solid #1D4088;
  }
  a {
    color:#ddd;
  }
  .estado-reserva {
    margin-top:10px;
    font-size:12px;
  }
  .links-reserva {
    text-align:right;
    margin-top:5px;
  }
  .descripcion {
    font-size:13px;
    margin-top:3px;
  }
  .links {
    float:right;
  }
  .precio {
    float:right;
    margin-top:3px;
  }
</style>

<%= image_tag 'banner.png', :style => 'margin:20px auto; display:block;' %>

<% @regalos.each do |regalo| %>
  <div class="regalo">
    <div class="links">
      Links:
      <% regalo.productos.each_with_index do |p,i| %>
        <%= link_to (i+65).chr, p.url, {:target => '_blank'} -%><%= "×#{p.cantidad}" if p.cantidad -%><%= "," if i<regalo.productos.size-1 %>
      <% end %>
    </div>
    <div><%= regalo.nombre %> </div>
    <div class="precio">USD <%= regalo.precio %> </div>
    <div class="descripcion"><%= regalo.descripcion %></div>
    <div class="estado-reserva">
      <% if regalo.reservado? %>
        Este regalo ya fue reservado
      <% else %>
        <%= link_to 'Reservar/Reserve', '', {'class' => 'reservar'} %>
      <% end %>
      <%= form_for regalo, :html => {:class => 'reserva'} do |f| %>
        Nombre/Name <%= f.text_field :nombre_amigo %>
        Email <%= f.text_field :email_amigo %>
        <br>
        Comentario/Comment <br> <%= f.text_area :comentario, :rows => 3 %>
        <div class="links-reserva">
          <%= link_to 'Cancelar/Cancel', '', {'class' => 'cancelar'} %> | 
          <%= link_to 'Confirmar/Confirm', '', {'class' => 'enviar-reserva'} %>
        </div>
      <% end %>
    </div>
  </div>
<% end %>
<div class="regalo">
  <div>Other Gift / Otro Regalo</div>
  <div class="descripcion">
    <p>Use this category if you have another gift in mind and you don't know how to send it to us or if you need our bank account info. Use the comments section below to specify.</p>
      <p>Usa esta categoría si quieres regalarnos algo que no está en la lista y no sabes como hacérnoslo llegar, o si necesitas información de nuestras cuentas bancarias. Puedes usar la sección de comentarios para poner detalles específicos.</p>
  </div>
  <div class="estado-reserva">
    <%= link_to 'Reservar/Reserve', '', {'class' => 'reservar'} %>
    <%= form_for :regalo, :html => {:class => 'reserva'} do |f| %>
      Nombre/Name <%= f.text_field :nombre_amigo %>
      Email <%= f.text_field :email_amigo %>
      <br>
      Comentario/Comment <br> <%= f.text_area :comentario, :rows => 3 %>
      <div class="links-reserva">
        <%= link_to 'Cancelar/Cancel', '', {'class' => 'cancelar'} %> | 
        <%= link_to 'Confirmar/Confirm', '', {'class' => 'enviar-reserva'} %>
      </div>
    <% end %>
  </div>
</div>

<script type="text/javascript">
  $(function(){

    $('a.reservar').click(function(){
      $(this).siblings('form.reserva').show();
      return false;
    });

    $('form.reserva a.cancelar').click(function(){
      $(this).parents('form.reserva').hide();
      return false;
    });

    $('a.enviar-reserva').click(function(e){
      var $form = $(this).parents('form');
      $form.ajaxSubmit({
        success:function(){
          $form.hide();
          var $link = $form.parents('.regalo').find('a.reservar');
          $link.after('Este regalo ya fue reservado');
          $link.remove();
          alert('¡Has reservado este regalo!');
        },
        statusCode: {
          403:function(){
            $form.hide();
            var $link = $form.parents('.regalo').find('a.reservar');
            $link.after('Este regalo ya fue reservado');
            $link.remove();
            alert('El regalo ya fue reservado; busca otro.');
          },
          400:function(){
            $form.hide();
            alert('No ingresaste tu nombre o email; intenta de nuevo.');
          }
        }
      });
      return false;
    });

  });
</script>
